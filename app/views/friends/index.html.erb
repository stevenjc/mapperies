
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

   <title>Stylish Portfolio - Start Bootstrap Theme</title>

    <!-- Bootstrap Core CSS -->
    <!--<link href="css/bootstrap.min.css" rel="stylesheet">-->
    <%= stylesheet_link_tag "bootstrap.min" %>


    <!-- Custom CSS -->
    <!--<link href="css/stylish-portfolio.css" rel="stylesheet">-->
    <%= stylesheet_link_tag "stylish-portfolio" %>


    <!-- Custom Fonts -->
    <!--<link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">-->
    <%= stylesheet_link_tag "font-awesome.min" %>

    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<!-- Navigation -->
<!--<a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>-->

<!-- Services -->
    <!-- The circle icons use Font Awesome's stacked icon classes. For more information, visit http://fontawesome.io/examples/ -->
    <%= form_tag("/friends/results", method: "post") do %>
        <%=label_tag(:s, "Search:") %>
        <%= text_field_tag(:s) %>
        <%= submit_tag("Search") %>
    <% end %>  
    <%= @friends === nil %>
    

    <section id="services" class="services bg-primary">

        <div class="container">
        <br />
            <% if @get_friend_reqs %>
                <% @get_friend_reqs.each do |f| %>
      
                
                    <div>
                        <% if !f.did_accept %>
                        <%= User.find(f.popular_model_id).first_name %> <%= User.find(f.popular_model_id).last_name %> has sent you a friend request: 
                    
                        <%= form_tag("/friends", :action => "index", method: "get") do %>
                            <%= hidden_field_tag(:accept, f.id) %>
                            <br />
                            <%= submit_tag("Accept as Friend") %>
                        <% end %>
                        <% end %>    
                    </div>         
                <% end %>
               <!-- <#% end %>-->
            <% end %>

            <div>
            Testing did_accept:
            <br />
            <% if @get_friend_reqs %>
                <% @get_friend_reqs.each do |f| %>
                    <%= f.did_accept %>
                    you acccepted <%= User.find(f.popular_model_id).first_name %> <%= User.find(f.popular_model_id).last_name %>'s friend request!
                <% end %>
            <% end %>
            </div>

            <div>
            Testing did_accept:
            <br />

            <% Popular::Friendship.where(popular_model_id:current_user.id).each do |u| %>
            <%= u.did_accept %>
            <% if u.did_accept %>
                    <%= User.find(u.friend_id).first_name %> <%= User.find(u.friend_id).last_name %> accepted your request!
            <% end %>
            <% end %>
            </div>

            <%= Popular::Friendship.where(did_accept:true) == [] %>

            <% Popular::Friendship.where(did_accept:true).each do |a| %>
                id is: <%= a.id %>
                <%= User.find(a.id).first_name %>
            <% end %>

        </div>

        <div class="container">

            <div class="row text-center">
                <div class="col-lg-10 col-lg-offset-1">
                <h2> My Friends </h2>
                <hr class="small">

                    <div class="row">
                        <td> <% if Popular::Friendship.where(popular_model_id:current_user.id) != nil && Popular::Friendship.where(did_accept:true) %></td> <!-- && Popular::Friendship.where(did_accept:true) **add this** -->
                            <% current_user_friends = Popular::Friendship.where(popular_model_id:current_user.id) %>
                            <% Popular::Friendship.where(popular_model_id:current_user.id).each do |u| %>
                                

                            <%# @all_users.find(current_user_friends.friend_id).each do |u| %>
                                
                                <div class="col-md-3 col-sm-6">
                                    <div class="service-item">
                                        <span class="fa-stack fa-4x">
                                            <i class="fa fa-circle fa-stack-2x"></i>
                                            <i class="fa fa-cloud fa-stack-1x text-primary"></i>
                                        </span>
                                        <h4>
                                        <tr>
                                        <td> 
                                        <%= User.find(u.friend_id).first_name %>
                                <%= User.find(u.friend_id).last_name %><%#= User.find(u).first_name %> <%#= User.find(u).last_name %></td>
                                        </tr>
                                        </h4>
                                        <!--<div class="albums">-->
                                        <div style="background-color:blue"><!--needs to go to css -->

                                        <span class="expand"><a href="#" class="btn btn-light">See Albums</a></span>
                                        <!--<span class="expand">See Albums</span>-->
                                        <ul>
                                            <li><span>Album 1</span></li>
                                            <li><span>Album 2</span></li>
                                            <li><span>Album 3</span></li>
                                        </ul>
                                       </div>
                                    </div>
                                </div>
                            <td><% end %></td>
                        <td><% end %></td>
                    </div>

                </hr>


                    </div>
                    <!-- /.row (nested) -->
                </div>
                <!-- /.col-lg-10 -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /.container -->
    </section>

<!--Need to put this in a different place  -->
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script type="text/javascript">
$(function(){
//hide or collapsed initially.
$('#services').find('ul').hide();
$('#services').find("span.expand").click(function(e){
    $(this).parent().children('ul').toggle();
});
});


</script>
<script>
function accept(){
    @did_accept = true;
}
</script>