<%= javascript_include_tag "/js/jquery.js" %>
<%= javascript_include_tag "/js/dragdrop.js" %>
<%= javascript_include_tag "/js/map_choose_default_location.js" %>
<%= javascript_include_tag "/js/change_to_edit.js" %>


<p id="notice"><%= notice %></p>


<iframe id="ifrm" src="/albums/<%= @album.id%>/form" style="width:70%;" hidden=true></iframe>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-10">
      <ul id="album_name_parent">
        <h3 id="album_name" onclick="edit()">
          <%= @album.album_name%>
        </h3>
      </ul>
      <div id="change_album_name">
        <button id="edit_name" onclick="edit()">Edit</button>
      </div>
    </div>
    <div class="col-md-2">
      <button class="btn btn-success" type="button" data-toggle="collapse" data-target="#photo_upload" aria-expanded="false" aria-controls="photo_upload" id="photo-upload-toggle">
        <i class="fa fa-upload" aria-hidden="true"></i>
      </button>
      <%= button_tag(type: 'button', class: "btn btn-warning", "data-toggle"=> "modal", "data-target"=> "#change_privacy") do %>
          Privacy Settings
      <% end %>
    </div>
  </div>
  <!--Modal Alert to Change Privacy  -->
  <div class="modal fade" tabindex="-1" role="dialog" id="change_privacy">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Select Privacy Setting for this Album</h4>
        </div>
        <div class="modal-footer">
          <body onload="showFriends()">
          <%= form_tag(album_path, method: "get")  do %>
            <%= select_tag("opts", options_for_select(["Public", "Private"], selected: @pub_private), :onchange => "showFriends()") %> <!--Need Javascript here when switching from public/private -->
          <div id="f1" style="display:none">
            <% @friends_shared = Array.new %>
            <% @friend_access = Hash.new %>
            <% AlbumView.where(album_view_id:@album.id).each do |av| %>
              <% if av.user_id != current_user.id %>
                <% @friends_shared.push(av.user_id) %>
                <% @access = nil %>
                <% if av.view_upload_access == 0 %>
                  <% @access = "View Only" %>
                <% elsif av.view_upload_access == 1 %>
                  <% @access = "View and Upload" %>
                <% end %>
                <% @friend_access[av.user_id] = @access %>
              <% end %>
            <% end %>

              <% if @friends_shared %>

                  <% get_friends.each do |f| %>
                    <% if @friends_shared.include? f.id %>
                      <div> <%= f.first_name %> <%= f.last_name %>
                      <!--show which access privilege the friend has, and give option to change that setting -->
                          <%= select_tag("change_access", options_for_select(["View Only", "View and Upload"], selected: @friend_access[f.id])) %>
                          <%= hidden_field_tag(:friend, f.id) %>

                          <%= link_to "Unshare", {:controller => "albums", :action => "show", :unshare => f}, method: "get" %>
                        </div>

                    <% else %>
                      <!--copied from new -->
                      <select name="friends[]" multiple="multiple">
                        <% get_friends.each do |f| %>
                          <option onclick="test()", value= <%= f.id %> >
                            <%= f.first_name %> <%= f.last_name %>
                          </option>
                        <% end %>
                      </select>
                    <% end %>
                  <% end %>

                  <div id="access" style="display:none">
                    <select name="access">
                      <option value = "0">View Only</option>
                      <option value = "1">View and Upload</option>
                    </select>
                  </div>

                <!--<#% end %>-->
              <% end %>
          </div>
              <%= submit_tag("Update") %>
          <% end %>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div class = "row">
    <div id="photo_container">
      <!--Check to see if there are photos, then display the photos in the album  -->
      <% if @photos.blank? %>
        <p> You don't have any photos yet </p>
      <% else %>
        <% @photos.each do |p| %>
          <span class="picture thumbnail col-md-1 col-md-offset-1">
            <%=image_tag p.image.url(:med), id:"image"%>
          </span>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class ="row">
    <div class ="col-md-12" id="upload_div">

      <div class="collapse" id="photo_upload">
        <h1> Upload Photos </h1>
        <!--Form to upload multiple photos  -->
        <%= form_for @photo, html: {multipart: true} do |f| %>
          <div class="form-group">
            <%= file_field_tag "images[]", type: :file, multiple: true, class: "upload_button"%>
          </div>
          <%= f.submit 'Upload' %>
        <% end %>
      </div>
    </div>
  </div>

  <div class = "row">
    <div class="col-md-12">
      <h3>Your album's default location is shown below</h3>
      <h5>To change the default location, click where you would like to change it to, then click on the green marker to confirm</h5>
      <!-- Show map to allow user to define default location for their album -->
      <div id="map" style="height:300px;width:300px;" class="col-mid-12">Try refreshing the page to see the map</div>
    </div>
  </div>
</div>
<!--Link to new_album_photo_path  -->
<!-- <%= button_to 'Upload Photos!', new_photo_path %> -->

<%= link_to 'Edit', edit_album_path(@album) %> |
<%= link_to 'Back', albums_path %>

<!--copied from new, needs to go in js-->
<script type="text/javascript">
    function test() {
      document.getElementById("access").style.display = "block";
    }

    function showFriends() {
        var selopt = document.getElementById("opts").value;
      if (selopt == "Private") {
            document.getElementById("f1").style.display = "block";
        }
        else {
          document.getElementById("f1").style.display = "none";

        }
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDmZ0UjQy-J4ELU51wczIAqv9nlywKb4mA&callback=initMap" async defer></script>
